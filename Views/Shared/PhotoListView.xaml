<?xml version="1.0" encoding="utf-8"?>

<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:shared="clr-namespace:FlickrApp.Views.Shared"
             xmlns:model="clr-namespace:FlickrApp.Models"
             x:Class="FlickrApp.Views.Shared.PhotoListView"
             Padding="5">

    <ContentView.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/Styles/Colors.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <DataTemplate x:Key="PhotoItemTemplate" x:DataType="model:FlickrPhoto">
                <Border StrokeShape="RoundRectangle 20"
                        StrokeThickness="0"
                        HeightRequest="220"
                        Padding="0"
                        Margin="5">
                    <FlexLayout.Basis>
                        <OnIdiom Phone="98%"
                                 Tablet="31.5%"
                                 Default="98%" />
                    </FlexLayout.Basis>
                    <FlexLayout.Grow>0</FlexLayout.Grow>
                    <FlexLayout.Shrink>0</FlexLayout.Shrink>
                    <Border.Shadow>
                        <Shadow Brush="Black" Offset="4,4" Radius="8" Opacity="0.3" />
                    </Border.Shadow>
                    <ImageButton Source="{Binding MediumUrl}"
                                 Aspect="AspectFill"
                                 Command="{Binding Source={RelativeSource AncestorType={x:Type shared:PhotoListView}}, Path=ItemTappedCommand}"
                                 CommandParameter="{Binding .}"
                                 CornerRadius="20"
                                 HorizontalOptions="FillAndExpand"
                                 VerticalOptions="FillAndExpand" />
                </Border>
            </DataTemplate>
        </ResourceDictionary>
    </ContentView.Resources>

    <ScrollView Orientation="Vertical"
                HorizontalScrollBarVisibility="Never"
                Scrolled="OnMainScrollViewScrolled">
        <FlexLayout x:Name="PhotosFlexLayout"
                    Direction="Row"
                    Wrap="Wrap"
                    JustifyContent="SpaceAround"
                    AlignItems="Start"
                    BindableLayout.ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type shared:PhotoListView}}, Path=ItemsSource}"
                    BindableLayout.ItemTemplate="{StaticResource PhotoItemTemplate}" />
    </ScrollView>
</ContentView>